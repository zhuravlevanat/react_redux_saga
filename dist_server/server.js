!function(e){var r={};function n(t){if(r[t])return r[t].exports;var o=r[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)n.d(t,o,function(r){return e[r]}.bind(null,o));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="",n(n.s=8)}([function(e,r){e.exports=require("http")},function(e,r){e.exports=require("url")},function(e,r){e.exports=require("querystring")},function(e,r){e.exports=require("mysql2/promise")},function(e,r){e.exports=require("uuidv4")},function(e,r){e.exports=require("nodemailer")},function(e,r){e.exports=require("jsdom")},function(e,r){e.exports=require("diff")},function(e,r,n){n(9),e.exports=n(10)},function(e,r){e.exports=require("@babel/polyfill")},function(e,r,n){"use strict";n.r(r);var t=n(0),o=n.n(t),a=n(1),s=n.n(a),c=n(2),u=n.n(c),i=n(3),l=n.n(i),p=n(4),f=n(5),d=n.n(f),h=n(6),v=n(7);function b(e,r,n,t,o,a,s){try{var c=e[a](s),u=c.value}catch(e){return void n(e)}c.done?r(u):Promise.resolve(u).then(t,o)}function g(){var e;return e=regeneratorRuntime.mark(function e(r,n){var t,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.a.createTransport({service:"gmail",auth:{user:"db.changing.logs@gmail.com",pass:"mailing12@"}}),e.next=3,t.sendMail({from:"db.changing.logs@gmail.com",to:n,subject:"Changes to table person",html:m(r)});case 3:o=e.sent,console.log("Message sent: %s",o.messageId);case 5:case"end":return e.stop()}},e)}),(g=function(){var r=this,n=arguments;return new Promise(function(t,o){var a=e.apply(r,n);function s(e){b(a,t,o,s,c,"next",e)}function c(e){b(a,t,o,s,c,"throw",e)}s(void 0)})}).apply(this,arguments)}function m(e){var r=new h.JSDOM("<html><head></head><body></body></html>"),n=r.window.document.createElement("table");n.style.border="1px solid black",n.innerHTML="<tr>\n                                <th>Time</th>\n                                <th>Version</th>\n                                <th>Val</th>\n                                <th>Change val</th>\n                                <th>User</th>\n                                <th>Old value / New value</th>\n                           </tr>";for(var t=0;t<e.length;t++){var o=r.window.document.createElement("tr");o.innerHTML='\n                <td style="border-top:1px solid black;">'.concat(e[t].time,'</td>\n                <td style="border-top:1px solid black;">').concat(e[t].version,'</td>\n                <td style="border-top:1px solid black;">').concat(e[t].val,'</td>\n                <td style="border-top:1px solid black;">').concat(e[t].change_val,'</td>\n                <td style="border-top:1px solid black;">').concat(e[t].user,'</td>\n                <td style="border-top:1px solid black;">').concat(E(e[t].old_value,e[t].new_value),"</td>\n            "),n.innerHTML+=o.outerHTML}return n.outerHTML}function E(e,r){var n=v.diffChars(e,r),t="",o="";return n.map(function(e){return e.added?(t="#d4fcbc",o="none"):e.removed?(t="#fbb6c2",o="line-through"):(t="#ffffff",o="none"),'<span style="background:'.concat(t,";text-decoration:").concat(o,';">').concat(e.value,"</span>")}).join("")}var x=function(e,r){return g.apply(this,arguments)};function R(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],t=!0,o=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(t=(s=c.next()).done)&&(n.push(s.value),!r||n.length!==r);t=!0);}catch(e){o=!0,a=e}finally{try{t||null==c.return||c.return()}finally{if(o)throw a}}return n}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function y(e,r,n,t,o,a,s){try{var c=e[a](s),u=c.value}catch(e){return void n(e)}c.done?r(u):Promise.resolve(u).then(t,o)}function O(e){return function(){var r=this,n=arguments;return new Promise(function(t,o){var a=e.apply(r,n);function s(e){y(a,t,o,s,c,"next",e)}function c(e){y(a,t,o,s,c,"throw",e)}s(void 0)})}}function T(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}n.d(r,"default",function(){return w});var w=function e(){var r=this;!function(r,n){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}(this),T(this,"httpServer",null),T(this,"errorCodes",{sqlError:"SQL_ERROR",noSuchTableInDatabase:"NO_SUCH_TABLE_IN_DATABASE",noSuchCommand:"NO_SUCH_COMMAND",noSuchServerCommand:"NO_SUCH_SERVER_COMMAND",noSuchIdOfConnection:"NO_SUCH_ID_OF_CONNECTION",parseError:"PARSE_ERROR",mailingError:"MAILING_ERROR"}),T(this,"host","localhost"),T(this,"currentTable",""),T(this,"connectionData",{}),T(this,"sqlConnections",{}),T(this,"contentTypes",{json:{"Content-Type":"application/json"}}),T(this,"httpServerPort",1010),T(this,"postProcessors",{}),T(this,"getProcessors",{}),T(this,"initialize",O(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.runHttpServer(),r.initRequestProcessors();case 2:case"end":return e.stop()}},e)}))),T(this,"connectToDb",function(){var e=O(regeneratorRuntime.mark(function e(n,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.createConnection(t);case 3:r.sqlConnections[n]=e.sent,r.connectionData[n]=t,console.info("Connected to DB!"),r.setConnectionErrorHandler(r.sqlConnections[n],n),e.next=14;break;case 9:throw e.prev=9,e.t0=e.catch(0),console.error("DB connection failed: ".concat(e.t0.code)),r.sqlConnections[n]=null,e.t0;case 14:case"end":return e.stop()}},e,null,[[0,9]])}));return function(r,n){return e.apply(this,arguments)}}()),T(this,"setConnectionErrorHandler",function(e,n){e.on("error",function(){var e=O(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.dbErrorHandler(t,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(r){return e.apply(this,arguments)}}())}),T(this,"dbErrorHandler",function(e,n){"PROTOCOL_CONNECTION_LOST"===e.code&&(r.sqlConnections[n].destroy(),r.sqlConnections[n]=null)}),T(this,"runHttpServer",function(){r.httpServer=o.a.createServer(function(e,n){return r.processRequest(e,n)}),r.httpServer.listen(r.httpServerPort,r.httpServerListenLog)}),T(this,"initRequestProcessors",function(){if(!r.httpServer)return console.error("Failed to init processors: HTTP server is not created."),!1;r.postProcessors={login:r.loginProcessor,logout:r.logoutProcessor,updatePerson:r.updatePersonProcessor,updateLogs:r.updateLogsProcessor,merge:r.mergeProcessor},r.getProcessors={person:r.personProcessor,personLog:r.personLogProcessor,personByID:r.personByIDProcessor,personData:r.personDataProcessor,personIds:r.personIdsProcessor}}),T(this,"httpServerListenLog",function(){console.info(new Date+"\nServer is listening on port "+r.httpServerPort)}),T(this,"processRequest",function(){var e=O(regeneratorRuntime.mark(function e(n,t){var o,a,c,i,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=s.a.parse(n.url,!0),a=o.pathname.substring(1),c=o.query,e.t0=n.method,e.next="POST"===e.t0?6:"GET"===e.t0?10:24;break;case 6:return i="",n.on("data",function(e){(i+=e).length>1e6&&n.connection.destroy()}),n.on("end",O(regeneratorRuntime.mark(function e(){var n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("login"===a||r.isVerifyUuid(c.uuid)){e.next=2;break}return e.abrupt("return",r.sendResponse(t,r.contentTypes.json,JSON.stringify(r.getErrorResponseObject("noSuchIdOfConnection",null))));case 2:if(n=u.a.parse(i),!r.postProcessors[a]){e.next=10;break}return e.next=6,r.postProcessors[a](n,c);case 6:o=e.sent,r.sendResponse(t,r.contentTypes.json,JSON.stringify(o)),e.next=11;break;case 10:r.sendResponse(t,r.contentTypes.json,JSON.stringify(r.getErrorResponseObject("noSuchCommand",null)));case 11:case"end":return e.stop()}},e)}))),e.abrupt("break",25);case 10:if(console.info("uuid",c.uuid),r.isVerifyUuid(c.uuid)){e.next=13;break}return e.abrupt("return",r.sendResponse(t,r.contentTypes.json,JSON.stringify(r.getErrorResponseObject("noSuchIdOfConnection",null))));case 13:if(console.info("target",a),!r.getProcessors[a]){e.next=22;break}return console.info("here1",a),e.next=18,r.getProcessors[a](c);case 18:l=e.sent,r.sendResponse(t,r.contentTypes.json,JSON.stringify(l)),e.next=23;break;case 22:r.sendResponse(t,r.contentTypes.json,JSON.stringify(r.getErrorResponseObject("noSuchCommand",null)));case 23:return e.abrupt("break",25);case 24:r.sendResponse(t,r.contentTypes.json,JSON.stringify(r.getErrorResponseObject("noSuchServerCommand",null)));case 25:case"end":return e.stop()}},e)}));return function(r,n){return e.apply(this,arguments)}}()),T(this,"getErrorResponseObject",function(e,n){return{isError:!0,code:r.errorCodes[e],data:n||null}}),T(this,"sendResponse",function(e,r,n){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Request-Method","*"),e.setHeader("Access-Control-Allow-Methods","*"),e.setHeader("Access-Control-Allow-Headers","*"),e.writeHead(200,r),e.write(n),e.end()}),T(this,"parseData",function(e,r){var n=[];return e.forEach(function(e){n.push({id:e.id,searchValue:JSON.parse(e[r]).name})}),n}),T(this,"checkDbTable",function(){var e=O(regeneratorRuntime.mark(function e(n,t,o){var a,s,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=null,e.prev=1,e.next=4,r.sqlConnections[n].execute("SHOW TABLES FROM ".concat(t," LIKE '").concat(o,"'"));case 4:s=e.sent,c=R(s,1),u=R(c[0],1),a=u[0],e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(1),e.t0;case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}},e,null,[[1,10]])}));return function(r,n,t){return e.apply(this,arguments)}}()),T(this,"createBDTable",function(){var e=O(regeneratorRuntime.mark(function e(n,t,o){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.sqlConnections[n].execute("CREATE TABLE IF NOT EXISTS ".concat(t," ").concat(o));case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 8:case"end":return e.stop()}},e,null,[[0,5]])}));return function(r,n,t){return e.apply(this,arguments)}}()),T(this,"getUserGrants",function(){var e=O(regeneratorRuntime.mark(function e(n,t){var o,a,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=null,e.prev=1,e.next=4,r.sqlConnections[n].execute("SHOW GRANTS FOR '".concat(t,"'@'").concat(r.host,"'"));case 4:a=e.sent,s=R(a,1),c=R(s[0],1),o=c[0],e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 13:return e.abrupt("return",Object.values(o)[0]);case 14:case"end":return e.stop()}},e,null,[[1,10]])}));return function(r,n){return e.apply(this,arguments)}}()),T(this,"isVerifyUuid",function(e){return r.sqlConnections.hasOwnProperty(e)}),T(this,"readLastId",function(){var e=O(regeneratorRuntime.mark(function e(n,t){var o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.sqlConnections[n].execute("SELECT MAX(id) FROM ".concat(t));case 3:return o=e.sent,a=R(o,1),s=a[0],e.abrupt("return",JSON.stringify(s[0]["MAX(id)"]));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 12:case"end":return e.stop()}},e,null,[[0,9]])}));return function(r,n){return e.apply(this,arguments)}}()),T(this,"loginProcessor",function(){var e=O(regeneratorRuntime.mark(function e(n){var t,o,a,s,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=null,o=Object(p.uuid)(),a=n.user,s=n.password,c=n.database,u=n.table,e.prev=3,e.next=6,r.connectToDb(o,{host:r.host,user:a,password:s,database:c});case 6:return e.next=8,r.checkDbTable(o,c,u);case 8:if(e.sent){e.next=11;break}return e.abrupt("return",r.getErrorResponseObject("noSuchTableInDatabase",r.errorCodes.noSuchTableInDatabase));case 11:return r.currentTable=u,e.next=14,r.getUserGrants(o,a);case 14:t=e.sent,e.next=20;break;case 17:return e.prev=17,e.t0=e.catch(3),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code)));case 20:return e.abrupt("return",{isError:!1,uuid:o,data:{state:"Connected!",grants:t}});case 21:case"end":return e.stop()}},e,null,[[3,17]])}));return function(r){return e.apply(this,arguments)}}()),T(this,"logoutProcessor",function(){var e=O(regeneratorRuntime.mark(function e(n,t){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.uuid,e.prev=1,e.next=4,r.sqlConnections[o].end();case 4:delete r.sqlConnections[o],console.info("Connection ".concat(o," end")),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 11:return e.abrupt("return",{isError:!1,data:"Connection end"});case 12:case"end":return e.stop()}},e,null,[[1,8]])}));return function(r,n){return e.apply(this,arguments)}}()),T(this,"personProcessor",function(){var e=O(regeneratorRuntime.mark(function e(n){var t,o,a,s,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.uuid,o=n.version,a=null,s=null,e.prev=3,e.next=6,r.sqlConnections[t].execute("SELECT id, ".concat(o," FROM ").concat(r.currentTable));case 6:c=e.sent,u=R(c,1),s=u[0],e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(3),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 14:e.prev=14,a=r.parseData(s,o),e.next=21;break;case 18:return e.prev=18,e.t1=e.catch(14),e.abrupt("return",r.getErrorResponseObject("parseError",r.errorCodes.parseError));case 21:return e.abrupt("return",{isError:!1,data:a});case 22:case"end":return e.stop()}},e,null,[[3,11],[14,18]])}));return function(r){return e.apply(this,arguments)}}()),T(this,"personDataProcessor",function(){var e=O(regeneratorRuntime.mark(function e(n){var t,o,a,s,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.info("ids"),t=n.uuid,o=n.version,a=null,s=null,e.prev=4,e.next=7,r.sqlConnections[t].execute("SELECT ".concat(o," FROM ").concat(r.currentTable));case 7:c=e.sent,u=R(c,1),s=u[0],a=s,console.info("row",s),e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(4),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 17:return e.abrupt("return",{isError:!1,data:a});case 18:case"end":return e.stop()}},e,null,[[4,14]])}));return function(r){return e.apply(this,arguments)}}()),T(this,"personLogProcessor",function(){var e=O(regeneratorRuntime.mark(function e(n){var t,o,a,s,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.uuid,o=n.version,a=null,e.prev=2,e.next=5,r.sqlConnections[t].execute("SELECT * FROM ".concat(r.currentTable,"_logs WHERE version='").concat(o,"'"));case 5:s=e.sent,c=R(s,1),u=c[0],a=u,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 14:return e.abrupt("return",{isError:!1,data:a});case 15:case"end":return e.stop()}},e,null,[[2,11]])}));return function(r){return e.apply(this,arguments)}}()),T(this,"personByIDProcessor",function(){var e=O(regeneratorRuntime.mark(function e(n){var t,o,a,s,c,u,i,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.uuid,o=n.version,a=n.id,s=null,c=null,e.prev=3,e.next=6,r.sqlConnections[t].execute("SELECT id, ".concat(o," FROM ").concat(r.currentTable," WHERE id=").concat(a));case 6:u=e.sent,i=R(u,1),l=R(i[0],1),c=l[0],e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(3),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 15:e.prev=15,s=JSON.parse(c[o]),e.next=22;break;case 19:return e.prev=19,e.t1=e.catch(15),e.abrupt("return",r.getErrorResponseObject("parseError",r.errorCodes.parseError));case 22:return e.abrupt("return",{isError:!1,data:s});case 23:case"end":return e.stop()}},e,null,[[3,12],[15,19]])}));return function(r){return e.apply(this,arguments)}}()),T(this,"updatePersonProcessor",function(){var e=O(regeneratorRuntime.mark(function e(n,t){var o,a,s,c,u,i,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.uuid,a=t.version,s=t.id,c=null,e.prev=2,e.next=5,r.sqlConnections[o].execute("UPDATE ".concat(r.currentTable," SET ").concat(a,"='").concat(JSON.stringify(n),"' WHERE id='").concat(s,"'"));case 5:u=e.sent,i=R(u,1),l=i[0],c=l,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 14:return e.abrupt("return",{isError:!1,data:c});case 15:case"end":return e.stop()}},e,null,[[2,11]])}));return function(r,n){return e.apply(this,arguments)}}()),T(this,"personIdsProcessor",function(){var e=O(regeneratorRuntime.mark(function e(n){var t,o,a,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.info("ids"),t=n.uuid,o=null,a=null,e.prev=4,e.next=7,r.sqlConnections[t].execute("SELECT id FROM ".concat(r.currentTable));case 7:s=e.sent,c=R(s,1),a=c[0],o=a,console.info("row",a),e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(4),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 17:return e.abrupt("return",{isError:!1,data:o});case 18:case"end":return e.stop()}},e,null,[[4,14]])}));return function(r){return e.apply(this,arguments)}}()),T(this,"updateLogsProcessor",function(){var e=O(regeneratorRuntime.mark(function e(n,t){var o,a,s,c,u,i,l,p,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.uuid,a=t.version,s=null,c=0,u=[],e.prev=4,e.next=7,r.createBDTable(o,"".concat(r.currentTable,"_logs"),"(\n                id int(50) NOT NULL AUTO_INCREMENT,\n                time timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n                version text,\n                ".concat("val"," varchar(50),\n                change_val varchar(50),\n                user varchar(50),\n                old_value varchar(100),\n                new_value varchar(100),\n                PRIMARY KEY (id)\n            )"));case 7:return e.next=9,r.createBDTable(o,"".concat(r.currentTable,"s_update_emails"),"(\n                id int(11) NOT NULL AUTO_INCREMENT,\n                email varchar(50),\n                PRIMARY KEY (id)\n            )");case 9:i=0,l=Object.values(n);case 10:if(!(i<l.length)){e.next=24;break}return p=l[i],e.next=14,r.sqlConnections[o].execute("INSERT INTO ".concat(r.currentTable,"_logs (version, ").concat("val",", change_val, user, old_value, new_value)\n                    VALUES(\n                        '").concat(a,"',\n                        '").concat("name","',\n                        '").concat(p[0],"',\n                        '").concat(p[1],"',\n                        '").concat(p[2],"',\n                        '").concat(p[3],"'\n                    )"));case 14:if(!e.sent){e.next=21;break}return c++,e.next=19,r.readLastId(o,"".concat(r.currentTable,"_logs"));case 19:f=e.sent,u=[].concat(function(e){if(Array.isArray(e)){for(var r=0,n=new Array(e.length);r<e.length;r++)n[r]=e[r];return n}}(d=u)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(d)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}(),[f]);case 21:i++,e.next=10;break;case 24:e.next=29;break;case 26:return e.prev=26,e.t0=e.catch(4),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 29:if(!(u.length>0)){e.next=38;break}return e.prev=30,e.next=33,r.mailing(o,u);case 33:e.next=38;break;case 35:return e.prev=35,e.t1=e.catch(30),e.abrupt("return",r.getErrorResponseObject("mailingError",r.errorCodes.mailingError));case 38:return s={affectedRows:c},e.abrupt("return",{isError:!1,data:s});case 40:case"end":return e.stop()}var d},e,null,[[4,26],[30,35]])}));return function(r,n){return e.apply(this,arguments)}}()),T(this,"mergeProcessor",function(){var e=O(regeneratorRuntime.mark(function e(n,t){var o,a,s,c,u,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.uuid,a=t.id,s=null,e.prev=2,e.next=5,r.sqlConnections[o].execute("UPDATE ".concat(r.currentTable," SET \n                    variant1='").concat(JSON.stringify(n),"', \n                    variant2='").concat(JSON.stringify(n),"', \n                    variant3='").concat(JSON.stringify(n),"', \n                    variant4='").concat(JSON.stringify(n),"'\n                WHERE id='").concat(a,"'"));case 5:c=e.sent,u=R(c,1),i=u[0],s=i,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",r.getErrorResponseObject("sqlError","".concat(e.t0.code,": ").concat(e.t0.sqlMessage)));case 14:return e.abrupt("return",{isError:!1,data:s});case 15:case"end":return e.stop()}},e,null,[[2,11]])}));return function(r,n){return e.apply(this,arguments)}}()),T(this,"mailing",function(){var e=O(regeneratorRuntime.mark(function e(n,t){var o,a,s,c,u,i,l,p,f,d,h,v,b;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o="",e.next=3,r.sqlConnections[n].execute("SELECT email FROM ".concat(r.currentTable,"s_update_emails"));case 3:for(a=e.sent,s=R(a,1),c=s[0],u=!0,i=!1,l=void 0,e.prev=9,p=c[Symbol.iterator]();!(u=(f=p.next()).done);u=!0)d=f.value,o+="".concat(d.email,", ");e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),i=!0,l=e.t0;case 17:e.prev=17,e.prev=18,u||null==p.return||p.return();case 20:if(e.prev=20,!i){e.next=23;break}throw l;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return o=o.substring(0,o.length-2),e.next=28,r.sqlConnections[n].execute("SELECT * FROM ".concat(r.currentTable,"_logs WHERE id IN (").concat(t.join(","),")"));case 28:return h=e.sent,v=R(h,1),b=v[0],e.next=33,x(b,o).catch(console.error);case 33:case"end":return e.stop()}},e,null,[[9,13,17,25],[18,,20,24]])}));return function(r,n){return e.apply(this,arguments)}}())};console.info("Production status: ".concat(!0,".")),O(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new w,e.next=3,r.initialize();case 3:case"end":return e.stop()}},e)}))()}]);